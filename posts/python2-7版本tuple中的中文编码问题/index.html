<!DOCTYPE html>
<html lang="en"><meta charset="utf-8"><meta name="generator" content="Hugo 0.87.0" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><title>python2.7版本tuple中的中文编码问题&nbsp;&ndash;&nbsp;比克王国</title><link rel="stylesheet" href="/css/core.min.ce377468f8d4eea57a095f8d4581a56bae44d81643a42e5e1ae36b10a2a1eb4e3fcd37985f285ccc586eb563916c2d3a.css" integrity="sha384-zjd0aPjU7qV6CV&#43;NRYGla65E2BZDpC5eGuNrEKKh604/zTeYXyhczFhutWORbC06"><meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="python2.7版本tuple中的中文编码问题" /><body><section id="header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/"><span class="site name">比克王国</span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/categories/">Categories</a><a class="nav item" href="/tags/">Tags</a></nav></div></span></div></section><section id="content"><div class="article-container"><section class="article header">
    <h1 class="article title">python2.7版本tuple中的中文编码问题</h1><p class="article date">2017-01-24</p></section><article class="article markdown-body"><p>在处理向mysql插入中文字符的过程中，碰到这样一个问题，明明是utf-8编码的中文<code>str</code> ，但是到了mysql里面显示的并不是中文，而是该中文字符串的utf-8编码的十六进制形式，下面是整个解决过程。</p>
<p>中文字符正常情况下应该是这样的：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> a <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;中文123&#39;</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> print(a)
中文123
</code></pre></div><p>但是你如果把一个包含中文的字符放到<code>tuple</code> 里面，却会变成这样：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> a <span style="color:#f92672">=</span> tuple([<span style="color:#e6db74">&#39;中文123&#39;</span>, <span style="color:#e6db74">&#39;hello&#39;</span>])
<span style="color:#f92672">&gt;&gt;&gt;</span> print(a)
(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\xe4\xb8\xad\xe6\x96\x87</span><span style="color:#e6db74">123&#39;</span>, <span style="color:#e6db74">&#39;hello&#39;</span>) <span style="color:#75715e"># 这里按理说应该显示的是(&#39;中文123&#39;, &#39;hello&#39;)</span>
</code></pre></div><p>中文字符显示成了编码后的十六进制形式，也就是说，<code>\x</code> 这个python的保留字符(用来表示它后面两个字符是十六进制值)，并没有得到“正确的”解析，实际上这里是把<code>'\xe4\xb8\xad\xe6\x96\x87'</code> 当成一个<code>raw strings</code> 来处理，这里面的<code>\x</code> 没有任何特别的意思，就是字面的<code>\x</code> ，所有它后面十六进制数也都只是表面上的意思。</p>
<h4 id="为什么会这样">为什么会这样？</h4>
<p><code>tuple</code> 应该是对它里面的<code>str</code> 做了一个<code>encode('string_escape')</code> 的操作，这个操作同<code>r''</code>等价，意思是生成一个<code>raw strings</code>，官方的解释是<strong>Produce a string that is suitable as string literal in Python source code</strong>, 我们做个实验：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> a <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;中文123&#39;</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> a
<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\xe4\xb8\xad\xe6\x96\x87</span><span style="color:#e6db74">123&#39;</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> print(a)
中文123
<span style="color:#f92672">&gt;&gt;&gt;</span> b <span style="color:#f92672">=</span> a<span style="color:#f92672">.</span>encode(<span style="color:#e6db74">&#39;string_escape&#39;</span>)
<span style="color:#f92672">&gt;&gt;&gt;</span> b
<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">xe4</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">xb8</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">xad</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">xe6</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">x96</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">x87123&#39;</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> print(b)
\xe4\xb8\xad\xe6\x96\x87123
</code></pre></div><p>嗯，一切都清楚了，那么问题来了，<code>tuple</code> 为啥要这么干呢&hellip;暂时不知道&hellip;</p>
<h4 id="解决办法">解决办法</h4>
<p>对字符做<code>decode('string_escape')</code>就可以了。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> c <span style="color:#f92672">=</span> b<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;string_escape&#39;</span>)
<span style="color:#f92672">&gt;&gt;&gt;</span> print(c)
中文123
</code></pre></div><h4 id="总结">总结</h4>
<p>首先，<code>tuple</code> 会它里面的中文字符做一个<code>r''</code> 的转换，这是个坑，踩过了就不说了。</p>
<p>其次，知道了<code>r''</code>的函数写法是这样的: <code>encode('string_escape')</code> ，也就是说，从此以后，可以对一个变量进行<code>r''</code> 操作啦。</p>
<h4 id="拓展">拓展</h4>
<p>其实还有一个<code>unicode_escape</code> 的编码方式</p>
<blockquote>
<p>官方的解释是Produce a string that is suitable as Unicode literal in Python source code.</p>
</blockquote>
<p>也就是说，将<code>\u</code> 这个保留字符按照字面意思去解释，也就是<code>raw unicode</code>话。</p>
<p><strong><code>string_escape</code> 和<code>unicode_escape</code> 都是将转义字符<code>raw</code> 话，将它们当做普通字符来看待，只不过前者只能针对<code>str</code> （编码后的字符）进行操作，后者是针对<code>unicode</code>字符进行操作。</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> a <span style="color:#f92672">=</span> <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;中文&#39;</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> a
<span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\u4e2d\u6587</span><span style="color:#e6db74">&#39;</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> print(a)
中文
<span style="color:#f92672">&gt;&gt;&gt;</span> b <span style="color:#f92672">=</span> a<span style="color:#f92672">.</span>encode(<span style="color:#e6db74">&#39;unicode_escape&#39;</span>)
<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">u4e2d</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">u6587&#39;</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> print(b)
\u4e2d\u6587
</code></pre></div><h4 id="题外话">题外话</h4>
<p>是时候转Python3了。</p>
<h4 id="参考链接">参考链接：</h4>
<p><a href="https://docs.python.org/2.7/reference/lexical_analysis.html#string-literals"target="_blank" rel="noopener noreferrer">python的转义字符</a>
</p>
<p>[<code>unicode_escape</code>和<code>string_escape](https://docs.python.org/2/library/codecs.html)</code></p>
</article><section class="article labels"><a class="category" href=/categories/programming/>Programming</a><a class="tag" href=/tags/python/>python</a></section>
</div>
<div class="article bottom"><section class="article navigation"><p><a class="link" href="/posts/fs-walk/"><span class="iconfont icon-article"></span>命令行之浏览文件系统</a></p><p><a class="link" href="/posts/%E7%83%A6%E4%BA%BA%E7%9A%84rpm%E5%AE%89%E8%A3%85%E9%94%99%E8%AF%AF/"><span class="iconfont icon-article"></span>烦人的rpm安装错误</a></p></section></div></section><section id="footer"><div class="footer-wrap">
    <p class="copyright">比克王国</p>
    <p class="powerby"><span>Powered&nbsp;by&nbsp;</span><a href="https://gohugo.io" 
        target="_blank" rel="noopener noreferrer">Hugo</a><span>&nbsp;&amp;&nbsp;</span><a href="https://themes.gohugo.io/hugo-notepadium/" 
        target="_blank" rel="noopener noreferrer">Notepadium</a></p></div>
</section></body>

</html>